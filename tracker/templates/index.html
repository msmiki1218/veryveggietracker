{% extends "layout.html" %}

{% block main %}
<div class="w3-container w3-padding-32 w3-theme-l5">
    <h1 class="w3-center w3-jumbo w3-text-theme">Your Very Veggie Journey</h1>
    
    <div class="w3-row-padding">
        {% for gen in generations %}
        <div class="w3-col l4 m6 s12 w3-margin-bottom">
            <a href="{{ url_for('tracker.generation_view', veggie_name=gen['name'].lower()) }}" style="text-decoration:none">
                <div class="w3-card-4 w3-round-large w3-white {% if gen['is_mastered'] == 1 %} mastered-glow {% endif %}">
                    
                    <header class="w3-container w3-round-large" style="background-color: {{ gen['color_code'] }}; position: relative;">

                        {% if gen['is_mastered'] == 1 %}
                        <span class="w3-tag w3-yellow w3-round w3-display-topright" style="margin: 8px; font-weight: bold; border: 1px solid orange;">
                            ğŸ† MASTERED
                        </span>
                        {% endif %}

                        <h3 style="background-color: {{ gen['color_code'] }}; color: white">{{ gen['name'] }}</h3>
                    </header>

                    <div class="w3-container w3-padding">
                        <p><strong>Career:</strong> {{ gen['career'] }}</p>
                        <p><strong>Aspiration(s):</strong> {{ gen['aspiration'] }}</p>
                        <p><strong>Note:</strong> {{ gen['requirements'] }}</p>
                        
                        {# Simplified math to help VSCode's parser #}
                        {% if gen['total_count'] > 0 %}
                            {% set percent = (gen['completed_count'] / gen['total_count'] * 100) | round | int %}
                        {% else %}
                            {% set percent = 0 %}
                        {% endif %}
                        
                        <div class="w3-light-grey w3-round-xlarge w3-small">
                            <div class="w3-container w3-round-xlarge w3-center" 
                                 style="width: {{ percent }}%; background-color: {{ gen['color_code'] }}; color: white;">
                                {{ percent }}%
                            </div>
                        </div>
                        <p class="w3-opacity w3-small w3-center">{{ gen['completed_count'] }} / {{ gen['total_count'] }} Goals Done</p>
                    </div>
                </div>
            </a>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}